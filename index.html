<!DOCTYPE html>
<html>
  <head>
    <title>Plaid Link Page</title>
    <script src="https://cdn.plaid.com/link/v2/stable/link.html?token=link-sandbox-1417da13-cda9-4209-a5a7-ee87e17951e1&isWebview=false"></script>
  </head>
  <body>
    <button id="link-button">Connect Your Bank</button>

    <script>
      window.onload = function () {
        var linkHandler = Plaid.create({
          token: "link-sandbox-43472585-467c-4e9a-b556-d6faf3e6793e",
          onSuccess: function(public_token, metadata) {
            const zapierUrl = "https://hooks.zapier.com/hooks/catch/22028118/u2cq71g/";
            const redirectUrl = `${zapierUrl}?public_token=${encodeURIComponent(public_token)}`;
            window.location.href = redirectUrl;
            alert("Success! You can close this page now.");
          },
          onExit: function(err, metadata) {
            console.log("Plaid Link exited", err, metadata);
          }
        });

        document.getElementById("link-button").onclick = function () {
          linkHandler.open();
        };
      };
    </script>
  </body>
</html>
